鍵交換部分の共通部分をくくり出してみる。

まずはベースとなる共通部分を作成する。
generateBase :: Base b => RandomGen -> b

秘密値を生成する。
generateSecret :: Secret s => RandomGen -> s

共通部と秘密値から自分の公開値を計算する。
calculatePublic :: (Base b, Secret s, Public p) => b -> s -> p

自分の秘密値と相手の公開値から共有値を計算する。
calculateCommon :: (Secret s, Public p, Common c) => s -> p -> c

全体のアルゴリズムを示す型を作成し、それはDHクラスのインスタンスとする。

class Base b where
	type Param b
	type Secret b
	type Public b
	generateBase :: CPRG g => g -> Param b -> (b, g)
	generateSecret :: CPRG g => g -> b -> (Secret b, g)
	calculatePublic :: b -> Secret b -> Public b
	calculateCommon :: b -> Secret b -> Public b -> ByteString

	encodeBase :: b -> ByteString
	decodeBase :: ByteString -> b
	encodePublic :: Public b -> ByteString
	decodePublic :: ByteString -> Public b

baseは

2014-06-10 Tue.

FragmentとContentの関係をもう一度見直す。
